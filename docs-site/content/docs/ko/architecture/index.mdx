---
title: 아키텍처
description: 배포 계획 및 튜닝을 위한 Bingsan 아키텍처 이해
---

# 아키텍처

Bingsan의 아키텍처를 이해하면 배포 계획, 성능 튜닝, 문제 해결에 도움이 됩니다.

## 개요

Bingsan은 Apache Iceberg REST Catalog 명세를 구현한 상태 비저장(stateless) Go 애플리케이션입니다. 모든 영구 상태는 PostgreSQL에 저장됩니다.

```
┌─────────────────────────────────────────────────────────────┐
│                      클라이언트                              │
│         (Spark, Trino, Flink, PyIceberg 등)                │
└─────────────────────────┬───────────────────────────────────┘
                          │ REST API (HTTP)
┌─────────────────────────▼───────────────────────────────────┐
│                    Bingsan 클러스터                          │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                     │
│  │ 노드 1  │  │ 노드 2  │  │ 노드 N  │  (상태 비저장)       │
│  │  :8181  │  │  :8181  │  │  :8181  │                     │
│  └────┬────┘  └────┬────┘  └────┬────┘                     │
│       └────────────┼────────────┘                           │
│                    │ 분산 잠금                               │
└────────────────────┼────────────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
┌───────▼───────┐       ┌────────▼────────┐
│  PostgreSQL   │       │   S3 / GCS      │
│  (메타데이터)  │       │   (데이터 레이크) │
└───────────────┘       └─────────────────┘
```

## 핵심 컴포넌트

### HTTP 서버

- [Fiber](https://gofiber.io/) (fasthttp) 기반
- 고성능, 저메모리 HTTP 처리
- HTTP/1.1 keep-alive 지원

### 데이터베이스 레이어

- 모든 메타데이터 저장에 PostgreSQL 사용
- pgx/v5를 통한 커넥션 풀링
- 자동 스키마 마이그레이션
- 분산 잠금을 위한 Advisory 락

### 스토리지 연동

- 테이블용 스토리지 경로 생성
- 클라이언트 데이터 접근을 위한 자격 증명 제공
- S3, GCS, 로컬 파일시스템 지원

### 이벤트 스트리밍

- WebSocket 기반 실시간 이벤트
- Publish/Subscribe 모델
- 네임스페이스 레벨 필터링

## 설계 원칙

### 상태 비저장 노드

각 Bingsan 인스턴스는 상태를 저장하지 않습니다:

- 모든 상태는 PostgreSQL에 저장
- 노드 간 통신 불필요
- 어떤 노드든 모든 요청 처리 가능
- 수평 확장 용이

### 낙관적 동시성 제어

테이블 커밋은 낙관적 동시성 제어를 사용합니다:

1. 클라이언트가 현재 메타데이터 읽기
2. 클라이언트가 요구사항과 함께 변경 제출
3. 서버가 현재 상태에 대해 요구사항 검증
4. 유효하면 변경 원자적 적용

### 분산 잠금

설정 가능한 타임아웃과 함께 PostgreSQL 행 레벨 잠금으로 동시 수정 방지:

- `SELECT ... FOR UPDATE`를 통한 행 레벨 락
- 트랜잭션별 설정 가능한 `lock_timeout`
- 지수 백오프를 통한 자동 재시도
- 락 충돌 원활히 처리

자세한 설정은 [분산 잠금](../performance/locking)을 참조하세요.

## 섹션

- [요청 흐름](./request-flow) - 요청 처리 방식
- [데이터 모델](./data-model) - 데이터베이스 스키마 및 메타데이터 저장
- [확장성](./scalability) - 확장 전략 및 한계

---
title: 뷰 API
description: 명명된 SQL 쿼리를 위한 뷰 관리 작업
---

# 뷰 API

뷰는 테이블처럼 참조할 수 있는 명명된 SQL 쿼리를 정의하는 방법을 제공합니다.

## 뷰 목록 조회

네임스페이스의 모든 뷰를 조회합니다.

### 요청

```http
GET /v1/namespaces/{namespace}/views
GET /v1/namespaces/{namespace}/views?pageToken={token}&pageSize={size}
```

### 쿼리 파라미터

| 파라미터 | 타입 | 필수 | 설명 |
|-----------|------|----------|-------------|
| `pageToken` | string | 아니오 | 페이지네이션 토큰 |
| `pageSize` | integer | 아니오 | 최대 결과 수 (기본값: 100) |

### 응답

```json
{
  "identifiers": [
    {"namespace": ["analytics"], "name": "daily_events"},
    {"namespace": ["analytics"], "name": "user_summary"}
  ],
  "next-page-token": null
}
```

### 예시

```bash
curl http://localhost:8181/v1/namespaces/analytics/views
```

---

## 뷰 생성

새 뷰를 생성합니다.

### 요청

```http
POST /v1/namespaces/{namespace}/views
```

### 요청 본문

```json
{
  "name": "daily_events",
  "schema": {
    "type": "struct",
    "schema-id": 0,
    "fields": [
      {"id": 1, "name": "event_date", "required": true, "type": "date"},
      {"id": 2, "name": "event_count", "required": true, "type": "long"},
      {"id": 3, "name": "unique_users", "required": true, "type": "long"}
    ]
  },
  "view-version": {
    "version-id": 1,
    "schema-id": 0,
    "timestamp-ms": 1705312200000,
    "summary": {
      "engine-name": "spark",
      "engine-version": "3.5.0"
    },
    "representations": [
      {
        "type": "sql",
        "sql": "SELECT DATE(event_time) AS event_date, COUNT(*) AS event_count, COUNT(DISTINCT user_id) AS unique_users FROM analytics.user_events GROUP BY DATE(event_time)",
        "dialect": "spark"
      }
    ],
    "default-catalog": "bingsan",
    "default-namespace": ["analytics"]
  },
  "properties": {
    "owner": "data-team"
  }
}
```

### 요청 필드

| 필드 | 타입 | 필수 | 설명 |
|-------|------|----------|-------------|
| `name` | string | 예 | 뷰 이름 |
| `location` | string | 아니오 | 사용자 정의 뷰 위치 |
| `schema` | object | 예 | 뷰의 출력 스키마 |
| `view-version` | object | 예 | SQL 정의가 포함된 뷰 버전 |
| `properties` | object | 아니오 | 뷰 속성 |

### 뷰 버전 필드

| 필드 | 타입 | 필수 | 설명 |
|-------|------|----------|-------------|
| `version-id` | integer | 예 | 버전 식별자 |
| `schema-id` | integer | 예 | 이 버전의 스키마 ID |
| `timestamp-ms` | long | 예 | 생성 타임스탬프 |
| `summary` | object | 아니오 | 엔진 정보 |
| `representations` | array | 예 | SQL 표현 |
| `default-catalog` | string | 아니오 | 정규화되지 않은 이름의 기본 카탈로그 |
| `default-namespace` | array | 아니오 | 기본 네임스페이스 |

### 예시

```bash
curl -X POST http://localhost:8181/v1/namespaces/analytics/views \
  -H "Content-Type: application/json" \
  -d '{
    "name": "daily_summary",
    "schema": {
      "type": "struct",
      "schema-id": 0,
      "fields": [
        {"id": 1, "name": "day", "required": true, "type": "date"},
        {"id": 2, "name": "total", "required": true, "type": "long"}
      ]
    },
    "view-version": {
      "version-id": 1,
      "schema-id": 0,
      "timestamp-ms": 1705312200000,
      "representations": [
        {
          "type": "sql",
          "sql": "SELECT DATE(ts) as day, COUNT(*) as total FROM events GROUP BY 1",
          "dialect": "spark"
        }
      ]
    }
  }'
```

---

## 뷰 로드

뷰의 현재 메타데이터를 로드합니다.

### 요청

```http
GET /v1/namespaces/{namespace}/views/{view}
```

### 응답

```json
{
  "metadata-location": "s3://bucket/warehouse/views/daily_events/metadata/00001-uuid.metadata.json",
  "metadata": {
    "view-uuid": "550e8400-e29b-41d4-a716-446655440000",
    "format-version": 1,
    "location": "s3://bucket/warehouse/views/daily_events",
    "current-version-id": 1,
    "versions": [
      {
        "version-id": 1,
        "schema-id": 0,
        "timestamp-ms": 1705312200000,
        "representations": [...]
      }
    ],
    "properties": {
      "owner": "data-team"
    }
  }
}
```

### 예시

```bash
curl http://localhost:8181/v1/namespaces/analytics/views/daily_events
```

---

## 뷰 존재 확인

뷰가 존재하는지 확인합니다.

### 요청

```http
HEAD /v1/namespaces/{namespace}/views/{view}
```

### 응답

- **200 OK**: 뷰 존재
- **404 Not Found**: 뷰가 존재하지 않음

### 예시

```bash
curl -I http://localhost:8181/v1/namespaces/analytics/views/daily_events
```

---

## 뷰 교체

뷰의 정의를 새 버전으로 교체합니다.

### 요청

```http
POST /v1/namespaces/{namespace}/views/{view}
```

### 요구사항

| 타입 | 필드 | 설명 |
|------|--------|-------------|
| `assert-view-uuid` | `uuid` | 뷰 UUID가 일치하는지 확인 |

### 업데이트 액션

| 액션 | 필드 | 설명 |
|--------|--------|-------------|
| `assign-uuid` | `uuid` | 뷰 UUID 할당 |
| `add-schema` | `schema` | 새 스키마 추가 |
| `add-view-version` | `view-version` | 뷰 버전 추가 |
| `set-current-view-version` | `view-version-id` | 현재 버전 설정 |
| `set-location` | `location` | 뷰 위치 설정 |
| `set-properties` | `updates` | 속성 업데이트 |
| `remove-properties` | `removals` | 속성 제거 |

### 오류

| 코드 | 오류 | 설명 |
|------|-------|-------------|
| 404 | `NoSuchViewException` | 뷰를 찾을 수 없음 |
| 409 | `CommitFailedException` | 요구사항이 충족되지 않음 |

---

## 뷰 삭제

뷰를 삭제합니다.

### 요청

```http
DELETE /v1/namespaces/{namespace}/views/{view}
```

### 응답

- **204 No Content**: 뷰 삭제됨

### 예시

```bash
curl -X DELETE http://localhost:8181/v1/namespaces/analytics/views/daily_events
```

---

## 뷰 이름 변경

뷰의 이름을 변경하거나 다른 네임스페이스로 이동합니다.

### 요청

```http
POST /v1/views/rename
```

### 요청 본문

```json
{
  "source": {
    "namespace": ["analytics"],
    "name": "old_view"
  },
  "destination": {
    "namespace": ["analytics"],
    "name": "new_view"
  }
}
```

### 예시

```bash
curl -X POST http://localhost:8181/v1/views/rename \
  -H "Content-Type: application/json" \
  -d '{
    "source": {"namespace": ["analytics"], "name": "daily_summary"},
    "destination": {"namespace": ["analytics"], "name": "daily_aggregates"}
  }'
```

---

## SQL 방언

뷰는 표현에서 여러 SQL 방언을 지원합니다:

| 방언 | 설명 |
|---------|-------------|
| `spark` | Apache Spark SQL |
| `trino` | Trino SQL |
| `presto` | Presto SQL |
| `flink` | Apache Flink SQL |
| `hive` | Apache Hive SQL |
| `dremio` | Dremio SQL |

뷰는 다른 엔진을 위해 여러 표현을 가질 수 있습니다:

```json
{
  "representations": [
    {"type": "sql", "sql": "SELECT ...", "dialect": "spark"},
    {"type": "sql", "sql": "SELECT ...", "dialect": "trino"}
  ]
}
```
